$(function(){var tooltipTriggerList=[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')),tooltipList=tooltipTriggerList.map(function(t){return new bootstrap.Tooltip(t)}),tabCounter=1,tabs=$("#tabs").tabs();setChart(),hotIssue(),hotKeyword(),$("#kw0").focus(),$(".keywordInput").on("click",function(){this.select()}),$(".keywordInput").on("keypress",function(t){var e=validKeyword("kw0");if(13===t.keyCode&&setInit()){var a=addTabs(e);submit("GO",tabs,a)}}),$("#go").on("click",function(){var t=validKeyword("kw0");if(setInit()){var e=addTabs(t);submit("GO",tabs,e)}}),$("#reset").on("click",function(){location.reload()}),$("#trend").on("click",function(){monthlyTrend()}),$("#btn-trend-exchange").on("click",function(){monthlyTrend()}),$("#views").on("click",function(){$("#viewsSearchHisModalBody").empty(),$.ajax({method:"POST",url:"/blper/views",dataType:"JSON",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(t){var e="";$.each(t,function(){var t="",a=4*Math.random();switch(Math.floor(a)+1){case 1:t="primary";break;case 2:t="secondary";break;case 3:t="success";break;case 4:t="dark";break;default:t="primary"}e+="<button type='button' class='searchWords btn btn-outline-"+t+" m-1'>"+this.query+"</button>"}),$("#viewsSearchHisModalBody").empty().append(e)},error:function(t){console.log("Error>"+t)}})}),$(document).on("click",".se-module-text",function(t){var e=parseInt($("#copyCnt").text());$("#copyCnt").text(e+1)}),$(document).on("click",".relation-word",function(t){var e=$(this).find(".relation-word-area").text();$("#kw0").val(e);var a=validKeyword("kw0");if(setInit()){var s=addTabs(a);submit("ADD",tabs,s)}}),tabs.on("click","i.fa-trash",function(){var t=$(this).closest("li").remove().attr("aria-controls");$("#"+t).remove(),tabs.tabs("refresh")}),$(document).on("click",".item-list",function(t){var e=$(this).data("path"),a=$(this).data("link"),s=$(this).data("title");if("hotkey"==e){$("#kw0").val(s);var n=validKeyword("kw0");if(setInit()){var i=addTabs(n);submit("GO",tabs,i)}}else window.open(a);return!1}),$(document).on("click",".item-link",function(t){var e=$(this).data("link");return window.open(e),!1}),$(document).on("click",".searchWords",function(t){$(".modal").modal("hide"),$("#kw0").val($(this).text());var e=validKeyword("kw0");if(setInit()){var a=addTabs(e);submit("GO",tabs,a)}}),$(document).on("click","canvas",function(t){$(".modal").modal("hide"),$("#kw0").val($(this).data("keyword"));var e=validKeyword("kw0");if(setInit()){var a=addTabs(e);submit("GO",tabs,a)}});var submit=function(t=null,e=null,a=null){setInitMonthlyInfo(),$("main").animate({scrollTop:0,scrollLeft:0},300),$("#tabs").addClass("active"),$("#wordArea").addClass("active");var s=$("#kw0").val(),n=$("#form").serialize();$.ajax({method:"POST",url:"/blper/find",dataType:"JSON",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:n,success:function(t){var n="<div id='"+a+"' class='set-top text-muted'>- 검색결과 없음 -</div>";if("0000"==t.code){var i="";$.each(t.items,function(e){$.each(t.items[e],function(a){$.each(t.items[e][a],function(){"report"==a?$("#monCnt_"+e+"_"+this.type).empty().text(this.total):(i+="<div class='item-list' data-site='"+e+"' data-title=\""+this.title+"\" data-link='"+this.link+"' style='cursor:pointer'>",i+="<span class='item-skip' title='"+this.title+"'>",i+="<img class='list_log'src='/img/icon/logo-"+e+".png'><i class='fas fa-file-alt "+a+"-color'></i> "+this.title,i+="</span>",this.date&&(i+="<span class='item-date'>"+this.date+"</span>"),i+="</div>")})})});var o="";if($.each(t.word,function(e){$.each(t.word[e],function(t){"report"==t?($("#monTotalCntPc").empty().text(this.monTotalCntPc),$("#monTotalCntMo").empty().text(this.monTotalCntMo)):(o+="<div class='relation-word word-list'><span class='relation-word-area text-word'>",o+="<img class='list_log'src='/img/icon/logo-"+e+".png'>"+this.text,o+="</span>","naver"==e&&(o+="<span class='item-cnt'><div class='cnt-pc'><i class='fas fa-desktop fa-sm float-start'></i>"+this.pcCnt+"</div><div class='cnt-mo'><i class='fas fa-mobile-alt fa-sm float-start'></i>"+this.moCnt+"</div></span>"),o+="</div>")})}),setChart(t.trend),a){$("#"+a).remove(),e.append("<div id='"+a+"' class='tab-form'>"+i+"</div>"),e.tabs("refresh"),$("#wordList").empty().append(o),$("b").css({color:"#fa8ba0"}),$("#keyWordGrade").empty().text(t.grade);var r="text-white";t.grade>0&&t.grade<3?r="text-success":t.grade>2&&t.grade<5?r="text-pramary":t.grade>4&&t.grade<8?r="text-warning":t.grade>7&&(r="text-danger"),$("#keyWordGrade").removeClass(),$("#keyWordGrade").addClass(r),$("#monthlyReport").removeClass("d-none"),monthlyReportHisAdd(s)}t.views>0&&$("#views").empty().text(t.views)}else if("9998"==t.code){alert("검색 제한 횟수 초과!");var d=$("#tab-nav > li").first().remove().attr("aria-controls");$("#"+d).remove(),e.tabs("refresh"),$("#tabs").removeClass("active"),$("#wordArea").removeClass("active"),$("#wordList").empty()}else $("#"+a).remove(),e.append(n),e.tabs("refresh");o||$("#wordList").empty().append(n)},error:function(t){console.log("Error>"+t)}})};function hotIssue(){$("#issueArea").addClass("active"),$("#issueList").empty().html(spinner()),$.ajax({method:"POST",url:"/blper/issue",dataType:"JSON",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(t){if("0000"==t.code){var e="";$.each(t.items,function(){e+="<div class='item-list' data-site='"+this.site+"' data-title=\""+this.title+"\" data-link='"+this.link+"'>",e+="<span class='item-skip' title='"+this.title+"'>",e+="<img class='list_log'src='/img/icon/logo-"+this.site+".png'>"+this.title,e+="</span>",e+="<span class='item-date'>"+this.date+"</span>",e+="</div>",0}),$("#issueList").empty().append(e)}else{$("#issueList").empty().append("<div class='set-top text-muted'>- 검색결과 없음 -</div>")}},error:function(t){console.log("Error>"+t)}})}function hotKeyword(){$("#keywordArea").addClass("active"),$("#keywordList").empty().html(spinner()),$.ajax({method:"POST",url:"/blper/keyword",dataType:"JSON",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(t){if("0000"==t.code){var e="";$.each(t.items,function(){new Date(this.date);e+="<div class='item-list' data-path='hotkey' data-site='"+this.site+"' data-title=\""+this.title+'">',e+="<span class='item-skip' title='"+this.title+"'>",e+="<img class='list_log'src='/img/icon/logo-"+this.site+".png'>"+this.title,e+="</span>",e+="<span class='item-link float-end px-1' data-link='"+this.link+"'><i class='fas fa-external-link-alt'></i></span>",e+="</div>",0}),$("#keywordList").empty().append(e)}else{$("#keywordList").empty().append("<div class='set-top text-muted'>- 검색결과 없음 -</div>")}},error:function(t){console.log("Error>"+t)}})}function monthlyTrend(){$("#viewsMonthlyTrendModalBody").empty().html(spinner()),$.ajax({method:"POST",url:"/blper/trend",dataType:"JSON",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(t){if("0000"==t.code){$("#viewsMonthlyTrendModalBody").empty();$.each(t.items,function(t){var e="trendChart_"+t;$("#"+e).remove(),$("#viewsMonthlyTrendModalBody").append('<div class="flex-grow-1 ps-4"><canvas class="my-4 bchartjs-render-monitor" id="'+e+'"" data-keyword="'+this.keyword+'" ></canvas></div>'),datas={labels:this.period,datasets:[{label:"추이",backgroundColor:"rgb(255 183 0 / 72%)",fill:!1,data:this.ratio,yAxisID:"y-axis-1"}]};var a=document.getElementById(e).getContext("2d"),{id:e}=new Chart(a,{type:"bar",data:datas,options:{plugins:{title:{display:!0,text:this.keyword},legend:{display:!1}},maintainAspectRatio:!1,responsive:!1}});0})}},error:function(t){console.log("Error>"+t)}})}function validKeyword(t){var e=null;if((e=$("#"+t).val().replace(/[^ㄱ-힣a-zA-Z0-9\u318D\u119E\u11A2\u2022\u2025a\u00B7\uFE55\s-,. ]/gi,"")).replace(/ /g,""))return $("#"+t).val(e),e;$("#"+t).focus(),$("#"+t).val("")}function setInit(){var t=!1;return $("#kw0").val()&&($("#monthlyReport").addClass("d-none"),$("#searchArea").removeClass("d-none"),$("#tab-nav").css({display:"block"}),$("#wordTitle").css({display:"block"}),$("#wordList").empty().html(spinner()),t=!0),t}function spinner(){return'<div class="set-spinner text-center w-100"><div class="spinner-grow text-primary" role="status"><span class="visually-hidden">Loading...</span></div><div class="spinner-grow text-warning" role="status"><span class="visually-hidden">Loading...</span></div><div class="spinner-grow text-success" role="status"><span class="visually-hidden">Loading...</span></div><div class="spinner-grow text-danger" role="status"><span class="visually-hidden">Loading...</span></div></div>'}function addTabs(t){var e="tab-content-"+tabCounter,a=$("<li><a href='#{href}'># #{word}</a><i class='fas fa-trash fa-sm' style='margin:7px 5px 0 -5px; cursor:pointer;'></i></li>".replace(/#\{href\}/g,"#"+e).replace(/#\{word\}/g,t));return tabs.find(".ui-tabs-nav").prepend(a),tabs.append("<div id='"+e+"' class='tab-form'>"+spinner()+"</div>"),tabs.tabs("refresh"),tabs.tabs({active:0}),tabCounter++,e}function setInitMonthlyInfo(){$("#keyWordGrade").empty().text("-"),$("#monTotalCntPc").empty().text(0),$("#monTotalCntMo").empty().text(0),$("#monCnt_naver_b").empty().text(0),$("#monCnt_naver_c").empty().text(0),$("#monCnt_naver_w").empty().text(0),$("#monCnt_daum_b").empty().text(0),$("#monCnt_daum_c").empty().text(0),$("#monCnt_daum_w").empty().text(0)}function monthlyReportHisAdd(t){var e=$("#keyWordGrade").text(),a=$("#monTotalCntPc").text(),s=$("#monTotalCntMo").text(),n=$("#monCnt_naver_b").text(),i=$("#monCnt_naver_c").text(),o="";o+="<tr>",o+="<th scope='row'>"+t+"</th>",o+="<td>"+a+"<br/>"+s+"</td>",o+="<td>"+n+" <br/>"+$("#monCnt_daum_b").text()+"</td>",o+="<td>"+i+" <br/>"+$("#monCnt_daum_c").text()+"</td>",o+="<td>"+e+"</td>",o+="</tr>",$("#viewsMonthlyHisModalBody tbody").prepend(o)}function setChart(datas=null){let trend_all=[],trend_bg=[],trend_period=[];if($("#myChart").remove(),$("#ketywordTrendChart").append('<canvas class="my-4 w-100 bchartjs-render-monitor" id="myChart" style="display: block;"></canvas>'),datas){var trend_sum_ratio=0;$.each(datas,function(device){$.each(datas[device],function(){trend_sum_ratio+=this.ratio,trend_bg.push("rgb(255 183 0 / 72%)"),eval("trend_"+device).push(this.ratio),trend_period.indexOf(this.period)<0&&trend_period.push(this.period)})}),trend_sum_ratio>0&&(trend_bg.push("rgb(0 76 216 / 72%)"),trend_all.push(Math.floor(trend_sum_ratio/datas.all.length)),trend_period.push("평균"))}datas={labels:trend_period,datasets:[{label:"추이",backgroundColor:trend_bg,fill:!1,data:trend_all,yAxisID:"y-axis-1"}]};var ctx=document.getElementById("myChart").getContext("2d"),myChart=new Chart(ctx,{type:"bar",data:datas,options:{plugins:{title:{display:!0,text:"키워드 추이"},legend:{display:!1}},maintainAspectRatio:!1,responsive:!0}})}});
